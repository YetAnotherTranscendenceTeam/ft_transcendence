asyncapi: 3.0.0
info:
  title: Social notifications
  version: 1.0.0
  description: Websocket in charge of communicating live social and activity related informations

servers:
  development:
    host: localhost:8080
    protocol: wss
    description: The development server

channels:
  social:
    bindings:
      ws:
        query:
          type: object
          required:
            - acess_token
          properties:
            token:
              type: string
              description: An JWT issued by the server authentication service
    address: /social/notify
    messages:
    # sent from server to client
      welcome:
        $ref: '#/components/messages/welcome'
      follow:
        $ref: '#/components/messages/follow'
      unfollow:
        $ref: '#/components/messages/unfollow'

    # sent from client to server
      ping:
        $ref: '#/components/messages/ping'
      goodbye:
        $ref: '#/components/messages/goodbye'
  
operations:
  publish:
    action: send
    channel:
      $ref: '#/channels/social'
    messages:
      - $ref: '#/channels/social/messages/welcome'
      - $ref: '#/channels/social/messages/follow'
      - $ref: '#/channels/social/messages/unfollow'

  subscribe:
    action: receive
    channel:
      $ref: '#/channels/social'
    messages:
      - $ref: '#/channels/social/messages/ping'
      - $ref: '#/channels/social/messages/goodbye'

components:
  messages:
    welcome:
      description: Message sent by the server uppon connection
      payload:
        type: object
        properties:
          event:
            type: string
            description: Event type
            enum:
              - welcome
          data:
            type: object
            properties:
              follows:
                type: array
                items:
                  type: object
                  properties:
                    account_id:
                      $ref: '#/components/schemas/account_id'
                    profile:
                      $ref: '#/components/schemas/profile'
                    status:
                      $ref: '#/components/schemas/status'
              self:
               $ref: '#/components/schemas/status'
        required:
          - event
          - data

    follow:
      description: Message sent by the server whenver the client follows another user
      payload:
        type: object
        properties:
          event:
            type: string
            enum:
              - follow
          data:
            type: object
            properties:
              account_id:
                $ref: '#/components/schemas/account_id'
              profile:
                $ref: '#/components/schemas/profile'
              status:
                $ref: '#/components/schemas/status'
            required:
              - account_id
              - profile
              - status
        required:
          - event
          - data
      
    unfollow:
      description: Message sent by the server whenever the client unfollows another user
      payload:
        type: object
        properties:
          event:
            type: string
            enum:
              - unfollow
          data:
            type: object
            properties:
              account_id:
                $ref: '#/components/schemas/account_id'
            required:
              - account_id
        required:
          - event
          - data

    ping:
      description: Sending this message to the server prevent the user from going inactive
      payload:
        type: object
        properties:
          event:
            type: string
            description: Event type
            enum:
              - ping
        required:
          - event

    goodbye:
      description: Send this message to the server disconnect the websocket
      payload:
        type: object
        properties:
          event:
            type: string
            description: Event type
            enum:
              - goodbye
        required:
          - event

  schemas:
    status:
      description: An activity status
      type: object
      properties:
        type:
          type: string
          enum:
            - online
            - offline
            - inactive
        data:
          type: object
      required:
        - type

    profile:
      description: A user profile
      type: object
      properties:
        account_id:
          $ref: '#/components/schemas/account_id'
        username:
          $ref: '#/components/schemas/username'
        avatar:
          $ref: '#/components/schemas/avatar'
    
    account_id:
      description: An account unique ID
      type: number
      example: 15465
    
    username:
      description: An unique username
      type: string
      example: "GonkGonk"
    
    avatar:
      description: A profile picture URI
      type: string
      format: uri
      example: https://example.com/image.jpg

